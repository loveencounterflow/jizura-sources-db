#!/usr/bin/env bash
# set -euo pipefail
# set -eo pipefail

cwd=$(pwd)
home="$(realpath "$(realpath "${BASH_SOURCE[0]}" | xargs dirname)"/..)"; cd "$home"
source bin/_lxu-utils


#...........................................................................................................
# select NodeJS executable:
# set +e; cmd=$( command -v nodexh|| command -v node|| enocmd 'node' ); set -e
if command -v nodexh &>/dev/null; then
  node_cmd=nodexh;
else
  node_cmd=node;
  fi

#...........................................................................................................
# select pager:
if command -v pspg &>/dev/null; then
  pager_cmd=(pspg -s6 --csv --csv-header=on --double-header);
elif command -v "${PAGER:-}" >/dev/null 2>&1; then
    pager_cmd=("$PAGER")
else
  pager_cmd=(less -SRN#5);
  fi

#-----------------------------------------------------------------------------------------------------------
echo "using $node_cmd"
echo "using ${pager_cmd[*]}"


#...........................................................................................................
### TAINT does setting `cwd` work?
# paged output:
CWD="$cwd" pipe_or_fail "$node_cmd" ./lib/cli.js "$@" -- "${pager_cmd[@]}"
# unpaged output:
# CWD="$cwd" "$node_cmd" ./lib/cli.js "$@"

# thx to https://unix.stackexchange.com/a/129077/280204
# cwd="$cwd" $cmd lib/cli.js "$@"
# node lib/cli.js "$*"

